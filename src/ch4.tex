\chapter{自陷和系统调用}

但运行一个进程时，一个CPU会进行通常的处理器循环：读取一条指令、递增程序计数器、执行指令，然后重复。但有一些事件可以控制用户程序必须返回到内核而不是执行下一条指令。这些事件包括一个硬件的信号、一个用户程序正在进行非法操作的（例如，访问没有页表项的虚拟地址）、或者一个用户程序通过系统调用请求内核服务。在处理这些事件时有三个主要的挑战：1）内核必须处理好用户态到内核态的切换（反之亦然）；2）内核和设备必须协调好它们的并行活动；3）内核必须理解设备的接口。解决这3个挑战需要对硬件有深入的了解，并且谨慎地进行编程，并且可能导致不透明的内核代码。本章解释xv6如何解决这三个挑战。

\section{页面错误异常}\label{s4.6}
